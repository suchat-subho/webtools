<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>DB Short URL</title>
<style>
body { font-family: Arial; margin: 40px; }
input, textarea { width: 100%; padding: 8px; margin: 8px 0; }
button { padding: 10px 20px; }
#out { margin-top:20px; white-space:pre-wrap; }
</style>
</head>
<body>

<div id="app" style="display:none;">

<h2>Google Apps Script URL Shortener</h2>

<label>Action:</label>
<input id="action" placeholder="set / get / delete">

<label>JSON (for set):</label>
<textarea id="json" placeholder='{"name":"Alice","age":25}'></textarea>

<button onclick="makeShort()">Generate Short URL</button>

<div id="shortUrl" style="margin-top:20px; font-size:18px; color:blue;"></div>

<hr>

<h3>Backend Response</h3>
<div id="out"></div>

</div>

<script>
const BACKEND =
  "https://script.google.com/macros/s/AKfycbwV7UQPANkrhRThtqhc7QS9-ev0DGJEgfbyphs42SThyPqQ5riTGtzYRO4pH6xD-OuWNQ/exec";

//
// CASE 1: If URL contains ?action=... then behave like an API
//
(function apiMode() {
    const params = new URLSearchParams(location.search);
    if (params.has("action")) {
        // Build backend URL
        const backendURL = BACKEND + "?" + params.toString();

        // Call backend, print raw JSON only
        fetch(backendURL)
            .then(r => r.text())
            .then(txt => {
                document.body.innerHTML = "";    // show nothing else
                document.write(txt);             // raw JSON output
            })
            .catch(err => {
                document.body.innerHTML = "";
                document.write(JSON.stringify({error: err.toString()}));
            });
    } else {
        // No action → show interface
        document.getElementById("app").style.display = "block";
    }
})();


//
// CASE 2: UI Mode — Use the web interface
//
function makeShort() {
    let action = document.getElementById("action").value.trim();
    let json = document.getElementById("json").value.trim();

    let params = new URLSearchParams();
    if (action) params.append("action", action);
    if (json) params.append("json", json);

    // Generate short URL
    let short = location.origin + location.pathname + "?" + params.toString();
    document.getElementById("shortUrl").innerHTML = "Short URL:<br>" + short;

    // Call backend
    let longUrl = BACKEND + "?" + params.toString();

    fetch(longUrl)
        .then(r => r.json())
        .then(j => document.getElementById("out").textContent = JSON.stringify(j, null, 2))
        .catch(e => document.getElementById("out").textContent = e);
}
</script>

</body>
</html>
