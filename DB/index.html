<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>DB Short URL</title>
<style>
body { font-family: Arial; margin: 40px; }
input, textarea { width: 100%; padding: 8px; margin: 8px 0; }
button { padding: 10px 20px; }
#out { margin-top:20px; white-space:pre-wrap; }
</style>
</head>
<body>

<h2>Google Apps Script URL Shortener</h2>

<label>Action:</label>
<input id="action" placeholder="set / get / delete">

<label>JSON (for set):</label>
<textarea id="json" placeholder='{"name":"Alice","age":25}'></textarea>

<button onclick="makeShort()">Generate Short URL</button>

<div id="shortUrl" style="margin-top:20px; font-size:18px; color:blue;"></div>

<hr>

<h3>Backend Response</h3>
<div id="out"></div>

<script>
const BACKEND = "https://script.google.com/macros/s/AKfycbwV7UQPANkrhRThtqhc7QS9-ev0DGJEgfbyphs42SThyPqQ5riTGtzYRO4pH6xD-OuWNQ/exec";

function makeShort() {
    let action = document.getElementById("action").value.trim();
    let json = document.getElementById("json").value.trim();

    let params = new URLSearchParams();
    if (action) params.append("action", action);
    if (json) params.append("json", json);

    // Short version (GitHub Pages version)
    let short = location.origin + location.pathname + "?" + params.toString();
    document.getElementById("shortUrl").innerHTML = "Short URL:<br>" + short;

    // Long version (actual Apps Script)
    let longUrl = BACKEND + "?" + params.toString();

    // Call backend
    fetch(longUrl)
        .then(r => r.json())
        .then(j => document.getElementById("out").textContent = JSON.stringify(j, null, 2))
        .catch(e => document.getElementById("out").textContent = e);
}

// Auto-forward when URL has query parameters
(function autoForward() {
    const params = new URLSearchParams(location.search);
    if (!params.has("action") && !params.has("json")) return;

    let longUrl = BACKEND + "?" + params.toString();
    fetch(longUrl)
        .then(r => r.json())
        .then(j => document.getElementById("out").textContent = JSON.stringify(j, null, 2))
        .catch(e => document.getElementById("out").textContent = e);
})();
</script>

</body>
</html>
